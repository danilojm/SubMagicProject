"use strict";(()=>{var e={};e.id=622,e.ids=[622],e.modules={3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11723:e=>{e.exports=require("querystring")},12412:e=>{e.exports=require("assert")},27910:e=>{e.exports=require("stream")},28354:e=>{e.exports=require("util")},29021:e=>{e.exports=require("fs")},29294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{e.exports=require("path")},44870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{e.exports=require("crypto")},55591:e=>{e.exports=require("https")},63033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{e.exports=require("zlib")},79428:e=>{e.exports=require("buffer")},79551:e=>{e.exports=require("url")},79646:e=>{e.exports=require("child_process")},79748:e=>{e.exports=require("fs/promises")},81630:e=>{e.exports=require("http")},83997:e=>{e.exports=require("tty")},94735:e=>{e.exports=require("events")},96330:e=>{e.exports=require("@prisma/client")},97110:(e,t,r)=>{r.r(t),r.d(t,{patchFetch:()=>z,routeModule:()=>j,serverHooks:()=>q,workAsyncStorage:()=>y,workUnitAsyncStorage:()=>h});var s={};r.r(s),r.d(s,{GET:()=>b,POST:()=>x,dynamic:()=>g});var o=r(96559),n=r(48088),i=r(37719),a=r(32190),u=r(19854),p=r(41098),l=r(7462),d=r(45697),c=r(91737);let g="force-dynamic",m=d.z.object({title:d.z.string().optional(),description:d.z.string().optional(),inputType:d.z.enum(["YOUTUBE_URL","VIDEO_FILE","AUDIO_FILE","OTHER_URL"]),inputSource:d.z.string().min(1,"Input source is required"),targetLanguages:d.z.array(d.z.string()).min(1,"At least one target language is required"),projectId:d.z.string().optional(),settings:d.z.object({whisperModel:d.z.enum(["tiny","base","small","medium","large"]).optional(),enableSpeakerDetection:d.z.boolean().optional(),customVocabulary:d.z.string().optional(),translationProvider:d.z.enum(["google","deepl","azure"]).optional(),enableAutoSync:d.z.boolean().optional(),qualityThreshold:d.z.number().min(0).max(1).optional(),maxSegmentLength:d.z.number().min(1).max(300).optional()}).optional()});async function x(e){try{let t=await (0,u.getServerSession)(p.N);if(!t?.user?.id)return a.NextResponse.json({error:"Unauthorized"},{status:401});let r=await e.json(),s=m.parse(r),o=await l.z.user.findUnique({where:{id:t.user.id}});if(!o)return a.NextResponse.json({error:"User not found"},{status:404});if(o.usageCount>=o.usageLimit)return a.NextResponse.json({error:"Usage limit exceeded. Please upgrade your plan."},{status:403});let n=s.title||function(e,t){if("YOUTUBE_URL"===t){let t=function(e){let t=e.match(/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/);return t?t[1]:null}(e);return`YouTube Video ${t?`(${t})`:""}`}return"VIDEO_FILE"===t||"AUDIO_FILE"===t?(e.split("/").pop()||e).replace(/\.[^/.]+$/,""):`Subtitle Job - ${new Date().toLocaleDateString()}`}(s.inputSource,s.inputType),i=await l.z.job.create({data:{userId:t.user.id,title:n,description:s.description,inputType:s.inputType,inputSource:s.inputSource,targetLanguages:s.targetLanguages,projectId:s.projectId,jobSettings:s.settings?{create:{whisperModel:s.settings.whisperModel||"base",enableSpeakerDetection:s.settings.enableSpeakerDetection||!1,customVocabulary:s.settings.customVocabulary,translationProvider:s.settings.translationProvider||"google",enableAutoSync:!1!==s.settings.enableAutoSync,qualityThreshold:s.settings.qualityThreshold||.8,maxSegmentLength:s.settings.maxSegmentLength||30}}:void 0},include:{jobSettings:!0,subtitles:!0}});return await l.z.user.update({where:{id:t.user.id},data:{usageCount:{increment:1}}}),setTimeout(()=>c.y.processJob(i.id),1e3),a.NextResponse.json({success:!0,data:i})}catch(e){if(console.error("Create job error:",e),e instanceof d.z.ZodError)return a.NextResponse.json({error:e.errors[0].message},{status:400});return a.NextResponse.json({error:"Internal server error"},{status:500})}}async function b(e){try{let t=await (0,u.getServerSession)(p.N);if(!t?.user?.id)return a.NextResponse.json({error:"Unauthorized"},{status:401});let{searchParams:r}=new URL(e.url),s=parseInt(r.get("page")||"1"),o=parseInt(r.get("limit")||"10"),n=r.get("status"),i=r.get("projectId"),d={userId:t.user.id};n&&"ALL"!==n&&(d.status=n),i&&(d.projectId=i);let[c,g]=await Promise.all([l.z.job.findMany({where:d,include:{subtitles:!0,jobSettings:!0,analytics:!0,project:{select:{id:!0,name:!0}}},orderBy:{createdAt:"desc"},skip:(s-1)*o,take:o}),l.z.job.count({where:d})]);return a.NextResponse.json({success:!0,data:{jobs:c,pagination:{page:s,limit:o,total:g,pages:Math.ceil(g/o)}}})}catch(e){return console.error("Get jobs error:",e),a.NextResponse.json({error:"Internal server error"},{status:500})}}let j=new o.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/jobs/route",pathname:"/api/jobs",filename:"route",bundlePath:"app/api/jobs/route"},resolvedPagePath:"D:\\Empresa\\SubMagic-deep\\professional-subtitle-generator\\app\\app\\api\\jobs\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:y,workUnitAsyncStorage:h,serverHooks:q}=j;function z(){return(0,i.patchFetch)({workAsyncStorage:y,workUnitAsyncStorage:h})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[243,613,240,190,231,697,892],()=>r(97110));module.exports=s})();